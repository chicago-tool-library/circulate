<%= form_with(model: reservation, url: [:admin, reservation], builder: SpectreFormBuilder, data: {controller: "reservation-dates"}) do |form| %>
  <%= form.text_field :name %>
  <%= form.date_field :started_at, label: "Start", data: {"reservation-dates-target": "startDate", action: "reservation-dates#disableInvalidEndDates"}, id: "start-date-field" %>
  <%= form.date_field :ended_at, label: "End", data: {"reservation-dates-target": "endDate"}, id: "end-date-field" %>

  <fieldset>
    <legend>Items on this reservation</legend>
    <%= form.dynamic_fields_for :reservation_holds do |dynamic_form| %>
      <%= dynamic_form.select :item_pool_id, item_pool_options %>
      <%= dynamic_form.number_field :quantity %>
      <%= dynamic_form.check_box :_destroy, label: "Remove?" %>
    <% end %>
  </fieldset>

  <%= form.actions do %>
    <%= form.submit %>
  <% end %>
  <script>
    document.addEventListener("turbo:load", function() {

      const startDateField = document.getElementById("start-date-field");
      const endDateField = document.getElementById("end-date-field");

      function setMinEndDate() {
        if (startDateField?.value) {
          let dayAfterStartDate = new Date(startDateField.value);
          dayAfterStartDate.setDate(dayAfterStartDate.getDate() + 1);
          minEndDate = dayAfterStartDate.toISOString().split('T')[0];
          endDateField.min = minEndDate;
        }
      }

      setMinEndDate();

      startDateField?.addEventListener("change", function() {
        setMinEndDate();
      });
  });
</script>
<% end %>
